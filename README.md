# Model_to_Online_App_with_fastai_and_hugging_face
Personal practice training a model with **fastai** and turning it to an online application with **hugging face**.

1. First I train and export the model.  
2. Then I upload the model on hugginface gradio space to run an online application.

[*Hugging face app link*](https://huggingface.co/spaces/loatlam/Model_to_onl_App)

## Reference

The Course:  
- **Practicle Deep Learning for Coders**  
[Lesson 2](https://course.fast.ai/Lessons/lesson2.html)

## Prerequisite

1. Pytorch high-level (basic).
2. Fastai high-level (basic).
3. Jupyter notebook basic.
4. Gradio basic.

## Train and export the model

### Directory: "Model_training"

I train a  simple fish classifier:
1. Goldfish
2. Tench
3. White shark

-> The result model is in **directory: Learner**.

#### For modification

You can run the notebook **clean_data_model_driven.ipynb** to get the exported model in **directory: Learner**.

I use a pre-train resnet18, fine-tune it with 2 epochs, in less than 20 seconds.  
You can fine-tune it more for better performance.  


## Model to online Application

### Directory: "Model_to_online_App"

This directory is hugging face gradio space repository. The same as you clone from the *Hugging face app link*.  
(Hugging face uses git)

The file **export.pkl** here is the exact same as **Model_training/Learner/export.pkl**.  
It is the model we trained and exported.

Hugging face space will:  
1. Host a server for us
2. Run the **app.py** file
3. Make the application interface with gradio (defined in **app.py** file).

The **app.py** file is an autogenerated file.  
I do all the experiments in the notebook **app.ipynb**.  
Then, within the notebook, export the necessary cells (cells begin with *#|export*) into **app.py** file. 

### Notice

#### Operating system

- On hugging face, they use Linux, so if we experiment on Windows and push to hugging face gradio space, problems can occur.  
- I exported a model on Windows, pushed it to hugging face gradio space and ran into an issue with WindowsPath. The problem is solved when I did on Linux.    
- Therefore, if you want to reproduce the whole process, I suggest to do it on Linux. (train and export model, push it to hugging face gradio space)  
(Recommend: WSL - Windows Subsystem for Linux)  

#### Requirement.txt

The **requirement.txt** file is important for hugging face gradio space to install needed packages.  
So make sure to have an appropriate **requirement.txt** file.  

## Environment

Pytorch 2.0.0+cu118  
fastai 2.7.12  
gradio 3.28.3   
